image: tiangolo/docker-with-compose

services:
    - docker:dind

stages:
    - test

test:
    stage: test
    services: 
        - redis
    variables:
        TESTING: "1"
        PYTHONDONTWRITEBYTECODE: "1"
    script:
        - cd api
        - pip install --upgrade pip
        - pip install --user pytest
        - pytest -p no:cacheprovider tests

  